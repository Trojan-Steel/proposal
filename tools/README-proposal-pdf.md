# Proposal PDF Export

## Summary
- In-app/preview `Download PDF` now calls `/api/proposal-pdf` and auto-downloads the PDF blob.
- `Generate Proposal PDF` opens preview with auto-download enabled (`autodownload=1`).
- PDFs are generated by Chromium (Puppeteer), preserving vector text for sharp/small output.

## Run in dev (recommended)
1. Install dependencies:
```bash
npm install
```
2. Start app + proposal server together:
```bash
npm run dev:all
```

This is the normal workflow for automatic PDF download from the app.

If PDF download fails, the UI now shows:
- health URL attempted
- PDF endpoint attempted
- HTTP status/response text or fetch exception

## Dev routing
- App runs on `http://localhost:5173`
- Proposal server runs on `http://localhost:4174`
- Vite proxy maps:
  - `/proposal-api/health` -> `http://localhost:4174/health`
  - `/proposal-api/render` -> `http://localhost:4174/render`

Quick check:
```bash
curl -i http://localhost:4174/health
```
Expected: `200` with JSON `{ "ok": true }`.

Scripted health check:
```bash
npm run proposal:health
```

## Generate from terminal (one-off)
```bash
npm run proposal:pdf -- --data=data/proposal-data.sample.json --out=output/proposal-email.pdf
```

## Inputs/Outputs
- Input data JSON: `--data=...` (must contain the proposal payload shape used by `tools/proposal.js`)
- Output PDF: `--out=...`
- Default output path: `output/proposal-email.pdf`

## Notes
- Auto-download endpoint: `POST /api/proposal-pdf` with `{ proposalData }`.
- Response headers:
  - `Content-Type: application/pdf`
  - `Content-Disposition: attachment; filename=\"...\"`
- Server script path: `scripts/proposal-pdf-server.mjs`.
